<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./css/cadastro.css">
    <link rel="stylesheet" href="./css/nav_&_footer.css">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="./js/funcoes.js"></script>
    <title>Cadastro</title>
</head>
<body>
  <div class="container-nav">
    <header class="site-header">
        <nav class="site-navigation">
            <div class="site-identity">
                <a href="./index.html"> <img src="./css/images/logo/logo-quatro-write-white.svg" alt=""></a>
            </div>
            <div class="hamburger">
                <div class="line1"></div>
                <div class="line2"></div>
                <div class="line3"></div>
            </div>
            <ul class="nav-links">
                <li><a href="./plans.html">Planos</a></li>
                <li><a href="./dashboard.html">Dashboard</a></li>
                <li><a href="./cadastro.html">Cadastro</a></li>
                <li><a href="./login.html">Login</a></li>
            </ul>
        </nav>
    </header>
</div>   
    <div class="main">
        <div class="container2">
            <div class="text">
				<h1>Cadastro</h1>
				<h4>Cria sua conta na <span>Quatro!</span></h4>
			</div>
            <form id="form_cadastro" name="cadastro" onsubmit="return cadastrar()">
				
				<div class="row">
					<input class="input-row" id="in_nome" name="n_nome" placeholder="Nome" type="text">
					<input class="input-row" id="in_negocio" name="n_negocio" placeholder="Negócio" type="text">
				</div>

              <div class="row">
              <input id="in_cnpj" name="n_cnpj" placeholder="CNPJ" type="number">
              <select name="" id="sl_plano" onchange="selecaoPlano()">
                <option value="undefined"> Selecione um Plano</option>
                <option value="startup">Start-Up</option>
                <option value="profissional">Profissional</option>
                <option value="media">Media</option>
              </select>
			</div>
	<input id="in_senha" name="n_senha" placeholder="Senha" type="password">

	<input id="in_senha_confirm" placeholder="Confirmar senha" type="password">
              

                <button type="submit">Criar conta</button>
            </form>
			<i>Já possui conta? <a href="./login.html" style="font-weight: bold;">Entrar</a></i>
            <div id="div_aguardar" style="display: none;">
              <img style="height: 30px;"
                src="https://mir-s3-cdn-cf.behance.net/project_modules/disp/35771931234507.564a1d2403b3a.gif" id="loading-gif">
            </div>
        </div>
    </div>
</body>
</html>
<script src="nav.js"></script>
<script>
  // pegando o plano pela a pagina plano
  function selecaoPlano(){
  in_plano.value = sl_plano.value;
}

function selectMedia(a){
  const selectElement = document.querySelector("#sl_plano");
  selectElement.value = a;
  in_plano.value = sessionStorage.plano;
}

window.onload(selectMedia(sessionStorage.plano));

  function limparFormulario() {
    document.getElementsByTagName("cadastro").reset();
  }

  function aguardar() {
    var divAguardar = document.getElementById("div_aguardar");
    divAguardar.style.display = "block";
}

function finalizarAguardar() {
  aguardar();
  var divAguardar = document.getElementById("div_aguardar");
    divAguardar.style.display = "none";
}

  function cadastrar() {
    aguardar();

    //validações
    var nome = in_nome.value;
    var cnpj = in_cnpj.value;
    var negocio = in_negocio.value;
    var plano = sl_plano.value;
    var senha = in_senha.value;
    var confirmacaoSenha = in_senha_confirm.value;
    
    if (nome.trim() == "" || cnpj.trim() == ""||  negocio.trim() == "" || plano.trim() == "undefined" || senha.trim() == "" || confirmacaoSenha.trim() == "") {
       window.alert("Preencha todos os campos/selecione para prosseguir!");
       limparFormulario();
      if (nome.trim() == "") {
        console.log('nome está em branco');
        limparFormulario();
      }

      if (cnpj.trim() == "") {
        console.log('cnpj está em branco');
        limparFormulario();
      }
      if (negocio.trim() == "") {
        console.log('Negócio está em branco')
        limparFormulario();
      }
      if (senha.trim() == "") {
        console.log('senha está em branco')
        limparFormulario();
      }
      if (confirmacaoSenha.trim() == "") {
        console.log('Confirmar senha está em branco')
        limparFormulario();
      }
      if (sl_plano.value == "undefined"){
        console.log("Selecione um plano")
        limparFormulario();
      }
      finalizarAguardar();
      return false;
    } 
    
    if (senha != confirmacaoSenha) {
       window.alert("As senhas inseridas devem ser iguais para prosseguir!");
      finalizarAguardar();
      limparFormulario();
      return false;
    } 

    var formulario = new URLSearchParams(new FormData(form_cadastro));
    fetch("/clientes/cadastrar", {
        method: "POST",
        body: formulario
    }).then(function (response) {
        if (response.ok) {
          window.location.href = 'login.html';
        } else {

            console.log('Erro de cadastro!');
            response.text().then(function (resposta) {
                div_erro.innerHTML = resposta;
            });
        }
    });

    return false;
  }
  var util = {
	f: {
		addStyle: function (elem, prop, val, vendors) {
			var i, ii, property, value
			if (!util.f.isElem(elem)) {
				elem = document.getElementById(elem)
			}
			if (!util.f.isArray(prop)) {
				prop = [prop]
				val = [val]
			}
			for (i = 0; i < prop.length; i += 1) {
				var thisProp = String(prop[i]),
					thisVal = String(val[i])
				if (typeof vendors !== "undefined") {
					if (!util.f.isArray(vendors)) {
						vendors.toLowerCase() == "all" ? vendors = ["webkit", "moz", "ms", "o"] : vendors = [vendors]
					}
					for (ii = 0; ii < vendors.length; ii += 1) {
						elem.style[vendors[i] + thisProp] = thisVal
					}
				}
				thisProp = thisProp.charAt(0).toLowerCase() + thisProp.slice(1)
				elem.style[thisProp] = thisVal
			}
		},
		cssLoaded: function (event) {
			var child = util.f.getTrg(event)
			child.setAttribute("media", "all")
		},
		events: {
			cancel: function (event) {
				util.f.events.prevent(event)
				util.f.events.stop(event)
			},
			prevent: function (event) {
				event = event || window.event
				event.preventDefault()
			},
			stop: function (event) {
				event = event || window.event
				event.stopPropagation()
			}
		},
		getSize: function (elem, prop) {
			return parseInt(elem.getBoundingClientRect()[prop], 10)
		},
		getTrg: function (event) {
			event = event || window.event
			if (event.srcElement) {
				return event.srcElement
			} else {
				return event.target
			}
		},
		isElem: function (elem) {
			return (util.f.isNode(elem) && elem.nodeType == 1)
		},
		isArray: function(v) {
			return (v.constructor === Array)
		},
		isNode: function(elem) {
			return (typeof Node === "object" ? elem instanceof Node : elem && typeof elem === "object" && typeof elem.nodeType === "number" && typeof elem.nodeName==="string" && elem.nodeType !== 3)
		},
		isObj: function (v) {
			return (typeof v == "object")
		},
		replaceAt: function(str, index, char) {
			return str.substr(0, index) + char + str.substr(index + char.length);
		}
	}
},
form = {
f: {
	init: {
		register: function () {
			var child, children = document.getElementsByClassName("field"), i
			for (i = 0; i < children.length; i += 1) {
				child = children[i]
				util.f.addStyle(child, "Opacity", 1)
			}
			children = document.getElementsByClassName("psuedo_select")
			for (i = 0; i < children.length; i += 1) {
				child = children[i]
				child.addEventListener("click", form.f.select.toggle)
			}
		},
	
	},
	select: {
		blur: function (field) {
			field.classList.remove("focused")
			var child, children = field.childNodes, i, ii, nested_child, nested_children
			for (i = 0; i < children.length; i += 1) {
				child = children[i]
				if (util.f.isElem(child)) {
					if (child.classList.contains("deselect")) {
						child.parentNode.removeChild(child)
					} else if (child.tagName == "SPAN") {
						if (!field.dataset.value) {
							util.f.addStyle(child, ["FontSize", "Top"], ["16px", "32px"])
						}
					} else if (child.classList.contains("psuedo_select")) {
						nested_children = child.childNodes
						for (ii = 0; ii < nested_children.length; ii += 1) {
							nested_child = nested_children[ii]
							if (util.f.isElem(nested_child)) {
								if (nested_child.tagName == "SPAN") {
									if (!field.dataset.value) {
										util.f.addStyle(nested_child, ["Opacity", "Transform"], [0, "translateY(24px)"])
									}
								} else if (nested_child.tagName == "UL") {
										util.f.addStyle(nested_child, ["Height", "Opacity"], [0, 0])
								}
							}
						}
					}
				}
			}
		},
		focus: function (field) {
			field.classList.add("focused")
			var bool = false, child, children = field.childNodes, i, ii, iii, nested_child, nested_children, nested_nested_child, nested_nested_children, size = 0
			for (i = 0; i < children.length; i += 1) {
				child = children[i]
				util.f.isElem(child) && child.classList.contains("deselect") ? bool = true : null
			}
			if (!bool) {
				child = document.createElement("div")
				child.className = "deselect"
				child.addEventListener("click", form.f.select.toggle)
				field.insertBefore(child, children[0])
			}
			for (i = 0; i < children.length; i += 1) {
				child = children[i]
				if (util.f.isElem(child) && child.classList.contains("psuedo_select")) {
					nested_children = child.childNodes
					for (ii = 0; ii < nested_children.length; ii += 1) {
						nested_child = nested_children[ii]
						if (util.f.isElem(nested_child) && nested_child.tagName == "UL") {
							size = 0
							nested_nested_children = nested_child.childNodes
							for (iii = 0; iii < nested_nested_children.length; iii += 1) {
								nested_nested_child = nested_nested_children[iii]
								if (util.f.isElem(nested_nested_child) && nested_nested_child.tagName == "LI") {
									size += util.f.getSize(nested_nested_child, "height")
									console.log("size: " + size)
								}
							}
							util.f.addStyle(nested_child, ["Height", "Opacity"], [size + "px", 1])
						}
					}
				}
			}
		},
		selection: function (child, parent) {
			var children = parent.childNodes, i, ii, nested_child, nested_children, time = 0, value
			if (util.f.isElem(child) && util.f.isElem(parent)) {
				parent.dataset.value = child.dataset.value
				value = child.innerHTML
			}
			for (i = 0; i < children.length; i += 1) {
				child = children[i]
				if (util.f.isElem(child)) {
					if (child.classList.contains("psuedo_select")) {
						nested_children = child.childNodes
						for (ii = 0; ii < nested_children.length; ii += 1) {
							nested_child = nested_children[ii]
							if (util.f.isElem(nested_child) && nested_child.classList.contains("selected")) {
								if (nested_child.innerHTML)  {
									time = 1E2
									util.f.addStyle(nested_child, ["Opacity", "Transform"], [0, "translateY(24px)"], "all")
								}
								setTimeout(function (c, v) {
									c.innerHTML = v
									util.f.addStyle(c, ["Opacity", "Transform", "TransitionDuration"], [1, "translateY(0px)", ".1s"], "all")
								}, time, nested_child, value)
							}
						}
					} else if (child.tagName == "SPAN") {
						util.f.addStyle(child, ["FontSize", "Top"], ["12px", "8px"])
				   }
			   }
			}
		},
		toggle: function (event) {
			util.f.events.stop(event)
			var child = util.f.getTrg(event), children, i, parent
			switch (true) {
				case (child.classList.contains("psuedo_select")):
				case (child.classList.contains("deselect")):
					parent = child.parentNode
					break
				case (child.classList.contains("options")):
					parent = child.parentNode.parentNode
					break
				case (child.classList.contains("option")):
					parent = child.parentNode.parentNode.parentNode
					form.f.select.selection(child, parent)
					break
			}
			parent.classList.contains("focused") ? form.f.select.blur(parent) : form.f.select.focus(parent)
		}
	}
    
}}

window.onload = form.f.init.register
</script>