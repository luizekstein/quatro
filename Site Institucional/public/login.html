<!DOCTYPE html>
<html lang="pt_br">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="shortcut icon" href="./css/imgs/icons/quatro_icone.ico" type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./css/login.css">
  <link rel="stylesheet" href="css/nav_&_footer.css">
  <script src="./js/funcoes.js"></script>
  <title>Entrar</title>
</head>

<body>

  <div class="background">
    <div class="shape"></div>
    <div class="shape"></div>
  </div>

  <div id="form_login">
    <h3>Entrar</h3>
    <label for="in_cnpj">CNPJ</label>
    <input maxlength="14" id="in_cnpj" onkeypress="return onlyNumber();" placeholder="CNPJ">

    <!-- Senha -->
    <label for="in_senha">Senha</label>
    <input maxlength="8" id="in_senha" type="password" placeholder="**********">


    <!-- BOTÃO de se cadastrar -->
    <button style="color: black;" onclick="cadastrar()" id="bota_cad">Entrar</button>
    <a href="./index.html">Voltar ao inicio</a>
  </div>

  <!-- Carregando login -->
  <div id="div_aguardar" class="loading-div">
    <input maxlength="8" id="in_senha_confirm" type="password" placeholder="Confirme a senha">
    <button style="color: black; margin-bottom: 7%;" onclick="cadastrar()" id="bota_cad">Cadastrar</button>
    <a style="margin-left: 30%;" href="./index.html">Voltar ao inicio</a>
  </div>
  <div id="div_aguardar" class="loading-div">
    <img style="height: 30px;"
      src="https://mir-s3-cdn-cf.behance.net/project_modules/disp/35771931234507.564a1d2403b3a.gif" id="loading-gif">
  </div>

</body>

</html>

<!-- Limpa o formulário após se cadastrar ou logar -->
<script>
  function limparFormulario() {
    document.getElementById("form_login").reset();
  }

  function cadastrar() {
    aguardar();

    var nomeVar = in_nome.value;
    var emailVar = in_email.value;
    var cnpjVar = in_cnpj.value;
    var senhaVar = in_senha.value;
    var confirmacaoSenhaVar = in_senha_confirm.value;

    // TODO: VERIFICAR AS VALIDAÇÕES QUE ELES ESTÃO APRENDENDO EM ALGORITMOS 
    if (nomeVar == "" || emailVar == "" || cnpjVar == "" || senhaVar == "" || confirmacaoSenhaVar == "") {

      window.alert("Preencha todos os campos para prosseguir!");
      if (nomeVar == "") {
        console.log('nome está em branco')
      }
      if (emailVar == "") {
        console.log('email está em branco')
      }

      if (cnpjVar == "") {
        console.log('cnpj está em branco');
      }
      if (senhaVar == "") {
        console.log('senha está em branco')
      }
      if (confirmacaoSenhaVar == "") {
        console.log('confirmacaoSenha está em branco')
      }
      finalizarAguardar();
      return false;
    }

    if (emailVar.indexOf("@") == -1 || emailVar.indexOf(".com") == -1) {
      window.alert("Ops, e-mail inválido! Verifique e tente novamente.");
      finalizarAguardar();
      return false;
    }

    if (senhaVar != confirmacaoSenhaVar) {
      window.alert("As senhas inseridas devem ser iguais para prosseguir!");
      finalizarAguardar();
      return false;
    }

    fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        nome: nomeVar,
        cnpj: cnpjVar,
        email: emailVar,
        senha: senhaVar,
      })
    }).then(function (resposta) {

      console.log("resposta: ", resposta);

      if (resposta.ok) {
        window.alert("Cadastro realizado com sucesso!");
        window.location = "index.html";
        limparFormulario();
        finalizarAguardar();
      } else {
        throw ("Houve um erro ao tentar realizar o cadastro!");
      }
    }).catch(function (resposta) {
      console.log(`#ERRO: ${resposta}`);
      finalizarAguardar();
    });
  }
</script>

<!-- Mostrar a senha -->
<script>
  // SCRIPT DE MOSTRAR SENHA

  document.getElementById('olho').addEventListener('mousedown', function () {
    document.getElementById('inp_senha').type = 'text';
  });

  document.getElementById('olho').addEventListener('mouseup', function () {
    document.getElementById('inp_senha').type = 'password';
  });

  // Para que o password não fique exposto apos mover a imagem.
  document.getElementById('olho').addEventListener('mousemove', function () {
    document.getElementById('inp_senha').type = 'password';
  });
</script>

<!-- Mascará no nome (primeira letra maiúscula sempre) -->
<script>
  function soLetras(e) {
    if (document.all) {
      var evt = event.keyCode;
    } else {
      var evt = e.charCode;
    }
    var chr = String.fromCharCode(evt);
    var re = /[A-Za-z\s]/;

    return (re.test(chr) || evt < 20);
  }
</script>

<!-- Mascará de celular -->
<script>
  function mask(e, id, mask) {
    var tecla = (window.event) ? event.keyCode : e.which;
    if ((tecla > 47 && tecla < 58)) {
      mascara(id, mask);
      return true;
    } else {
      if (tecla == 8 || tecla == 0) {
        mascara(id, mask);
        return true;
      } else return false;
    }
  }

  function mascara(id, mask) {
    var i = id.value.length;
    var carac = mask.substring(i, i + 1);
    var prox_char = mask.substring(i + 1, i + 2);
    if (i == 0 && carac != '#') {
      insereCaracter(id, carac);
      if (prox_char != '#') insereCaracter(id, prox_char);
    } else if (carac != '#') {
      insereCaracter(id, carac);
      if (prox_char != '#') insereCaracter(id, prox_char);
    }

    function insereCaracter(id, char) {
      id.value += char;
    }
  }
</script>

<!-- Aceitar apenas números (int) -->
<script>
  function onlyNumber(evt) {
    var theEvent = evt || window.event;
    var key = theEvent.keyCode || theEvent.which;
    key = String.fromCharCode(key);
    //var regex = /^[0-9.,]+$/;
    var regex = /^[0-9.]+$/;
    if (!regex.test(key)) {
      theEvent.returnValue = false;
      if (theEvent.preventDefault) theEvent.preventDefault();
    }
  }
</script>